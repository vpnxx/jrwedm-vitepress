"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),ge=require("../empty/index.cjs"),we=require("../scrollbar/index.cjs"),N=require("../utils/index.cjs"),be={class:"select-search"},Ce=["readonly","disabled"],ye=["title"],Be=["title","onMouseenter","onClick"],Ee=e.defineComponent({__name:"Select",props:{options:{default:()=>[]},label:{default:"label"},value:{default:"value"},placeholder:{default:"请选择"},disabled:{type:Boolean,default:!1},width:{default:"auto"},height:{default:void 0},size:{default:"middle"},allowClear:{type:Boolean,default:!1},search:{type:Boolean,default:!1},placement:{default:"bottom"},flip:{type:Boolean,default:!0},to:{type:[String,Boolean],default:"body"},filter:{type:[Function,Boolean],default:!0},maxDisplay:{default:6},scrollbarProps:{default:()=>({})},modelValue:{default:void 0}},emits:["update:modelValue","change","openChange"],setup(Y,{emit:G}){const l=Y,R=e.ref(!1),c=e.ref([]),u=e.ref(),S=e.ref(null),f=e.ref(),d=e.ref(!1),k=e.ref(!1),i=e.ref(),n=e.ref(!1),p=e.ref(!0),w=e.ref(!1),x=e.ref(!1),h=e.ref(!1),V=e.ref(!1),{colorPalettes:D,shadowColor:J}=N.useInject("Select"),s=e.ref(null),F=e.ref(0),M=e.ref(0),q=e.ref("bottom"),O=e.ref(null),g=e.ref(),P=e.ref(null),z=e.ref(),H=e.ref(null),W=e.ref(),K=e.ref(document.documentElement.clientWidth),T=e.ref(document.documentElement.clientHeight),{isSupported:Q}=N.useOptionsSupported("passive"),B=G,Z=e.computed(()=>typeof l.width=="number"?`${l.width}px`:l.width),_=e.computed(()=>{const t={small:24,middle:32,large:40};return l.height!==void 0?`${l.height}px`:`${t[l.size]}px`});e.computed(()=>l.options.length>l.maxDisplay);const ee=e.computed(()=>({maxHeight:`${l.maxDisplay*32+8}px`})),te=e.computed(()=>{const t=g.value?.top??0,o=z.value?.top??0,a=t-o,m=g.value?.bottom??0,$=(z.value?.bottom??0)-m,v=g.value?.left??0,L=z.value?.left??0,r=v-L,y=g.value?.width??0;switch(q.value){case"bottom":return{transformOrigin:"0 0",top:`${a+M.value}px`,left:`${r}px`,minWidth:`${y}px`,width:`${y}px`};case"top":return{transformOrigin:"100% 100%",bottom:`${$+M.value}px`,left:`${r}px`,minWidth:`${y}px`,width:`${y}px`};default:return{transformOrigin:"0 0",top:`${a+M.value}px`,left:`${r}px`,minWidth:`${y}px`,width:`${y}px`}}});e.watch(()=>[l.placement,l.flip],()=>{E()},{deep:!0}),e.watch(n,t=>{t&&!R.value&&(R.value=!0)}),e.watch(n,t=>{B("openChange",t),l.search&&!t&&(f.value=void 0,k.value=!1)}),e.watchEffect(()=>{l.search?(f.value?c.value=l.options.filter(t=>typeof l.filter=="function"?l.filter(f.value,t):t[l.label].includes(f.value)):n.value?c.value=[...l.options]:setTimeout(()=>{c.value=[...l.options]},200),c.value.length&&f.value?i.value=c.value[0][l.value]:i.value=null):c.value=l.options}),e.watchEffect(()=>{se()}),e.onMounted(()=>{j()}),e.onBeforeUnmount(()=>{U()});const I=N.useMutationObserver(s,()=>{F.value!==s.value?.scrollTop&&(F.value=s.value?.scrollTop??0,E())},{subtree:!0,attributes:!0});N.useEventListener(window,"resize",oe);function le(){let t=H.value?.parentElement;for(;t;){if(t===document.documentElement){P.value=document.documentElement;return}const{position:o}=getComputedStyle(t);if(o!=="static"){P.value=t;return}t=t.parentElement}}function oe(){K.value=document.documentElement.clientWidth,T.value=document.documentElement.clientHeight,j(),E()}function j(){U(),s.value=A(O.value),s.value&&s.value.addEventListener("scroll",E,Q.value?{passive:!0}:void 0),s.value===document.documentElement?I.start():I.stop()}function U(){s.value&&s.value.removeEventListener("scroll",E),s.value=null}function ae(t){return t===document.documentElement?null:t.parentElement}function A(t){if(t===null)return null;const o=ae(t);return o===null?null:o===document.documentElement?document.documentElement:(m=>{const{overflow:C,overflowX:$,overflowY:v}=getComputedStyle(m);return/(auto|scroll|overlay)/.test(C+v+$)})(o)?o:A(o)}function E(){n.value&&X()}async function X(){await e.nextTick(),le(),z.value=P.value?.getBoundingClientRect(),g.value=O.value?.getBoundingClientRect(),W.value=H.value?.offsetHeight,M.value=g.value.height+4,l.flip&&(q.value=ue())}function ne(){if(s.value){const t=s.value.getBoundingClientRect();return{top:t.top<0?0:t.top,bottom:t.bottom>T.value?T.value:t.bottom}}return{top:0,bottom:T.value}}function ue(){const{top:t,bottom:o}=g.value,{top:a,bottom:m}=ne(),C=t-a,$=m-o;return v(l.placement,[]);function v(L,r){if(L==="bottom")if(r.includes("bottom")){if(!r.includes("top"))return v("top",r)}else return $<W.value+4?v("top",[...r,"bottom"]):"bottom";else if(L==="top")if(r.includes("top")){if(!r.includes("bottom"))return v("bottom",r)}else return C<W.value+4?v("bottom",[...r,"top"]):"top";return l.placement}}function se(){if(l.modelValue){const t=l.options.find(o=>o[l.value]===l.modelValue);t?(u.value=t[l.label],i.value=t[l.value]):(u.value=l.modelValue,i.value=null)}else u.value=null,i.value=null}function re(){V.value=!0}function ie(){V.value=!1,n.value&&(n.value=!1),l.search&&(h.value=!1,p.value=!0,k.value=!1)}function ce(){d.value=!0,l.allowClear&&(u.value||l.search&&f.value)&&(p.value=!1,w.value=!0,l.search&&(h.value=!1))}function ve(){d.value=!1,l.allowClear&&w.value&&(w.value=!1,l.search||(p.value=!0)),l.search&&(n.value?(h.value=!0,p.value=!1):(h.value=!1,p.value=!0))}function fe(t,o){d.value=!!o,i.value=t}async function de(){if(b(),!l.search&&S.value&&(S.value.style.opacity="0"),n.value=!n.value,n.value&&X(),!i.value&&u.value){const t=l.options.find(o=>o[l.label]===u.value);i.value=t?t[l.value]:null}l.search&&(w.value||(p.value=!n.value,h.value=n.value))}function pe(t){k.value=!!t.target?.value}function me(){V.value&&(b(),x.value=!0),w.value=!1,u.value=null,i.value=null,n.value=!1,h.value=!1,p.value=!0,B("update:modelValue"),B("change")}function b(){S.value?.focus()}function he(t,o,a){l.modelValue!==t&&(u.value=o,i.value=t,B("update:modelValue",t),B("change",t,o,a)),x.value=!1,b()}return(t,o)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["select-wrap",{"select-focused":V.value,"search-select":t.search,"select-small":t.size==="small","select-large":t.size==="large","select-disabled":t.disabled}]),style:e.normalizeStyle(`
      --select-width: ${Z.value};
      --select-height: ${_.value};
      --select-primary-color-hover: ${e.unref(D)[4]};
      --select-primary-color-focus: ${e.unref(D)[4]};
      --select-primary-shadow-color: ${e.unref(J)};
    `),onClick:o[7]||(o[7]=a=>t.disabled?()=>!1:de())},[e.createElementVNode("div",{ref_key:"selectContentRef",ref:O,class:"select-content-container",onMouseenter:ce,onMouseleave:ve},[e.createElementVNode("span",be,[e.withDirectives(e.createElementVNode("input",{ref_key:"inputRef",ref:S,class:e.normalizeClass(["search-input",{"caret-show":n.value||x.value}]),type:"text",autocomplete:"off",readonly:!t.search,disabled:t.disabled,onInput:pe,"onUpdate:modelValue":o[0]||(o[0]=a=>f.value=a),onBlur:o[1]||(o[1]=a=>!d.value&&!t.disabled?ie():()=>!1),onFocus:o[2]||(o[2]=a=>t.disabled?()=>!1:re())},null,42,Ce),[[e.vModelText,f.value]])]),e.createElementVNode("span",{class:e.normalizeClass(["select-item",{"select-placeholder":!u.value||n.value,"select-item-hidden":k.value}]),title:u.value},e.toDisplayString(u.value||t.placeholder),11,ye),(e.openBlock(),e.createElementBlock("svg",{class:e.normalizeClass(["arrow-svg",{"arrow-rotate":n.value,"show-svg":p.value}]),focusable:"false","data-icon":"down",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",viewBox:"64 64 896 896"},[...o[8]||(o[8]=[e.createElementVNode("path",{d:"M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"},null,-1)])],2)),(e.openBlock(),e.createElementBlock("svg",{class:e.normalizeClass(["search-svg",{"show-svg":h.value}]),focusable:"false","data-icon":"search",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",viewBox:"64 64 896 896"},[...o[9]||(o[9]=[e.createElementVNode("path",{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"},null,-1)])],2)),(e.openBlock(),e.createElementBlock("svg",{class:e.normalizeClass(["clear-svg",{"show-svg":w.value}]),focusable:"false","data-icon":"close-circle",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true","fill-rule":"evenodd",viewBox:"64 64 896 896",onClick:e.withModifiers(me,["stop"])},[...o[10]||(o[10]=[e.createElementVNode("path",{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm127.98 274.82h-.04l-.08.06L512 466.75 384.14 338.88c-.04-.05-.06-.06-.08-.06a.12.12 0 00-.07 0c-.03 0-.05.01-.09.05l-45.02 45.02a.2.2 0 00-.05.09.12.12 0 000 .07v.02a.27.27 0 00.06.06L466.75 512 338.88 639.86c-.05.04-.06.06-.06.08a.12.12 0 000 .07c0 .03.01.05.05.09l45.02 45.02a.2.2 0 00.09.05.12.12 0 00.07 0c.02 0 .04-.01.08-.05L512 557.25l127.86 127.87c.04.04.06.05.08.05a.12.12 0 00.07 0c.03 0 .05-.01.09-.05l45.02-45.02a.2.2 0 00.05-.09.12.12 0 000-.07v-.02a.27.27 0 00-.05-.06L557.25 512l127.87-127.86c.04-.04.05-.06.05-.08a.12.12 0 000-.07c0-.03-.01-.05-.05-.09l-45.02-45.02a.2.2 0 00-.09-.05.12.12 0 00-.07 0z"},null,-1)])],2))],544),(e.openBlock(),e.createBlock(e.Teleport,{disabled:t.to===!1,to:t.to===!1?null:t.to},[e.createVNode(e.Transition,{name:"slide","enter-from-class":"slide-enter","enter-active-class":"slide-enter","enter-to-class":"slide-enter slide-enter-active","leave-from-class":"slide-leave","leave-active-class":"slide-leave slide-leave-active","leave-to-class":"slide-leave slide-leave-active"},{default:e.withCtx(()=>[R.value?e.withDirectives((e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"selectPanelRef",ref:H,class:"select-panel-container",style:e.normalizeStyle({...te.value,"--select-option-bg-color-active":e.unref(D)[0]})},[e.withDirectives(e.createVNode(e.unref(we.default),e.mergeProps({style:{...ee.value,"--scrollbar-rail-vertical-right":"2px 0 2px auto"},class:"select-options-panel",onClick:e.withModifiers(b,["stop"]),onMouseenter:o[3]||(o[3]=a=>d.value=!0),onMouseleave:o[4]||(o[4]=a=>d.value=!1)},t.scrollbarProps),{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value,(a,m)=>(e.openBlock(),e.createElementBlock("p",{key:m,class:e.normalizeClass(["select-option",{"option-hover":!a.disabled&&a[t.value]===i.value,"option-selected":a[t.label]===u.value,"option-disabled":a.disabled}]),title:a[t.label],onMouseenter:C=>fe(a[t.value],a.disabled),onClick:e.withModifiers(C=>a.disabled?b():he(a[t.value],a[t.label],m),["stop"])},e.toDisplayString(a[t.label]),43,Be))),128))]),_:1},16,["style"]),[[e.vShow,c.value.length]]),e.withDirectives(e.createElementVNode("div",{class:"select-options-panel options-panel-empty",onClick:e.withModifiers(b,["stop"]),onMouseenter:o[5]||(o[5]=a=>d.value=!0),onMouseleave:o[6]||(o[6]=a=>d.value=!1)},[e.createVNode(e.unref(ge.default),{image:"outlined"})],544),[[e.vShow,!c.value.length]])],4)),[[e.vShow,n.value]]):e.createCommentVNode("",!0)]),_:1})],8,["disabled","to"]))],6))}});exports.default=Ee;
