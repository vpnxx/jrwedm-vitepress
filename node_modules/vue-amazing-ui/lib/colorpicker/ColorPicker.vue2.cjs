"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),l=require("seemly"),We=require("../tooltip/index.cjs"),se=require("../input/index.cjs"),ue=require("../button/index.cjs"),ie=require("../utils/index.cjs"),Ye={class:"color-picker-preview"},Je={class:"color-picker-preview-sliders"},Ke={key:0,class:"color-picker-preview-circle"},Qe=["value"],et={class:"color-picker-input"},tt={class:"color-picker-input-group"},lt={key:0,class:"color-picker-swatches"},rt=["onClick"],ot={key:0,class:"color-picker-actions"},at={key:1,class:"color-picker-footer"},nt={class:"color-picker-wrap"},st={class:"color-picker-fill"},g="12px",ce=12,p="6px",de=6,ut=e.defineComponent({__name:"ColorPicker",props:{width:{default:"100%"},label:{type:Function,default:void 0},tooltipStyle:{default:()=>({})},inputProps:{default:()=>({})},showAlpha:{type:Boolean,default:!0},showPreview:{type:Boolean,default:!1},size:{default:"middle"},disabled:{type:Boolean,default:!1},value:{default:void 0},modes:{default:()=>["rgb","hex","hsl"]},swatches:{default:()=>[]},actions:{default:()=>[]},footer:{default:void 0}},emits:["update:value","complete","confirm","clear"],setup(ve,{emit:he}){const u=ve,q=e.ref(),P=e.ref(null),L=e.ref(null),T=e.ref(null),V=e.ref(0),O=e.ref(1),_=e.ref([0,0]),M=e.ref(),c=e.ref(u.value),m=e.ref(F(c.value)||u.modes[0]||"rgb"),D=e.ref(),$=e.ref([]),{colorPalettes:J,shadowColor:pe}=ie.useInject("ColorPicker"),R=he,me=ie.useSlotsExist("footer"),fe=e.computed(()=>me.value||u.footer),ge=e.computed(()=>({width:g,height:g,borderRadius:p,left:`calc(${_.value[0]}% - ${p})`,bottom:`calc(${_.value[1]}% - ${p})`})),be=e.computed(()=>v.value?`rgb(${v.value[0]}, ${v.value[1]}, ${v.value[2]})`:""),ke=e.computed(()=>({backgroundColor:be.value,borderRadius:p,width:g,height:g})),K=e.computed(()=>({height:g,borderRadius:p})),ye=e.computed(()=>({position:"relative",boxShadow:"inset 0 0 2px 0 rgba(0, 0, 0, 0.24)",backgroundImage:"linear-gradient(90deg, red, #ff0 16.66%, #0f0 33.33%, #0ff 50%, #00f 66.66%, #f0f 83.33%, red)",height:g,borderRadius:p})),Se=e.computed(()=>({left:`calc((${V.value}%) / 359 * 100 - ${p})`,borderRadius:p,width:g,height:g})),we=e.computed(()=>({backgroundColor:`hsl(${V.value}, 100%, 50%)`,borderRadius:p,width:g,height:g})),Ee=e.computed(()=>v.value?`linear-gradient(to right, rgba(${v.value[0]}, ${v.value[1]}, ${v.value[2]}, 0) 0%, rgba(${v.value[0]}, ${v.value[1]}, ${v.value[2]}, 1) 100%)`:""),Ve=e.computed(()=>({left:`calc(${O.value*100}% - ${p})`,borderRadius:p,width:g,height:g})),$e=e.computed(()=>({backgroundColor:v.value?l.toRgbaString(v.value):void 0,borderRadius:p,width:g,height:g})),Q=e.computed(()=>v.value&&l.toHexString(v.value)),ee=e.computed(()=>typeof u.width=="number"?`${u.width}px`:u.width),Z=e.computed(()=>`${{small:24,middle:32,large:40}[u.size]}px`),He=e.computed(()=>{const t={small:6,middle:8,large:10};return`calc((${Z.value} - ${t[u.size]}px) / 3)`}),j=e.computed(()=>F(c.value)),x=e.computed(()=>m.value.toUpperCase()+(u.showAlpha?"A":"")),Ne=e.computed(()=>x.value.split(""));let b,k,A,B,H,N,C,y;const w=e.computed(()=>{if(!c.value)return null;switch(j.value){case"hsv":return l.hsva(c.value);case"hsl":return[b,k,A,y]=l.hsla(c.value),[...l.hsl2hsv(b,k,A),y];case"rgb":case"hex":return[H,N,C,y]=l.rgba(c.value),[...l.rgb2hsv(H,N,C),y]}}),v=e.computed(()=>{if(!c.value)return null;switch(j.value){case"rgb":case"hex":return l.rgba(c.value);case"hsv":return[b,k,B,y]=l.hsva(c.value),[...l.hsv2rgb(b,k,B),y];case"hsl":return[b,k,A,y]=l.hsla(c.value),[...l.hsl2rgb(b,k,A),y]}}),z=e.computed(()=>{if(!c.value)return null;switch(j.value){case"hsl":return l.hsla(c.value);case"hsv":return[b,k,B,y]=l.hsva(c.value),[...l.hsv2hsl(b,k,B),y];case"rgb":case"hex":return[H,N,C,y]=l.rgba(c.value),[...l.rgb2hsl(H,N,C),y]}}),E=e.computed(()=>{switch(m.value){case"rgb":case"hex":return v.value;case"hsv":return w.value;case"hsl":return z.value}}),te=e.computed(()=>u.swatches.map(t=>{const r=F(t);return{value:t,mode:r,legalValue:qe(t,r)}}));e.watch(()=>u.value,t=>{c.value=t}),e.watch(()=>[m.value,E.value],()=>{m.value==="hex"?D.value=E.value===null?void 0:(u.showAlpha?l.toHexaString:l.toHexString)(E.value):E.value===null?$.value=new Array(u.showAlpha?4:3).fill(void 0):$.value=E.value.map((t,r)=>u.showAlpha&&r===3?`${Math.floor(t*100)}%`:`${Math.floor(t)}`)},{immediate:!0,deep:!0}),e.watchEffect(()=>{(M.value===void 0||M.value!==c.value)&&w.value&&(V.value=w.value[0],O.value=w.value[3],_.value=[w.value[1],w.value[2]]),M.value=void 0});function f(t,r){r==="cursor"?M.value=t:M.value=void 0,c.value=t,R("update:value",t),r==="input"&&R("complete",t)}function Ce(t,r){const o=w.value?w.value[3]:1;switch(_.value=[t,r],m.value){case"hsv":f((u.showAlpha?l.toHsvaString:l.toHsvString)([V.value,t,r,o]),"cursor");break;case"hsl":f((u.showAlpha?l.toHslaString:l.toHslString)([...l.hsv2hsl(V.value,t,r),o]),"cursor");break;case"rgb":f((u.showAlpha?l.toRgbaString:l.toRgbString)([...l.hsv2rgb(V.value,t,r),o]),"cursor");break;case"hex":f((u.showAlpha?l.toHexaString:l.toHexString)([...l.hsv2rgb(V.value,t,r),o]),"cursor");break}}function Re(t){P.value&&(document.addEventListener("mousemove",G),document.addEventListener("mouseup",le),G(t))}function G(t){if(!P.value)return;const{width:r,height:o,left:n,bottom:S}=P.value.getBoundingClientRect(),a=(S-t.clientY)/o,s=(t.clientX-n)/r,i=100*(s>1?1:s<0?0:s),d=100*(a>1?1:a<0?0:a);Ce(i,d)}function le(){document.removeEventListener("mousemove",G),document.removeEventListener("mouseup",le),R("complete",c.value)}function ze(t){if(V.value=t,!w.value)return;const[,r,o,n]=w.value;switch(m.value){case"hsv":f((u.showAlpha?l.toHsvaString:l.toHsvString)([t,r,o,n]),"cursor");break;case"rgb":f((u.showAlpha?l.toRgbaString:l.toRgbString)([...l.hsv2rgb(t,r,o),n]),"cursor");break;case"hex":f((u.showAlpha?l.toHexaString:l.toHexString)([...l.hsv2rgb(t,r,o),n]),"cursor");break;case"hsl":f((u.showAlpha?l.toHslaString:l.toHslString)([...l.hsv2hsl(t,r,o),n]),"cursor");break}}function Ae(t){L.value&&(document.addEventListener("mousemove",W),document.addEventListener("mouseup",re),W(t))}function Be(t){return t=Math.round(t),t>=360?359:t<0?0:t}function W(t){if(!L.value)return;const{width:r,left:o}=L.value.getBoundingClientRect(),n=Be((t.clientX-o-de)/(r-ce)*360);ze(n)}function re(){document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",re),R("complete",c.value)}function Me(t){switch(m.value){case"hsv":[b,k,B]=w.value,f(l.toHsvaString([b,k,B,t]),"cursor");break;case"rgb":[H,N,C]=v.value,f(l.toRgbaString([H,N,C,t]),"cursor");break;case"hex":[H,N,C]=v.value,f(l.toHexaString([H,N,C,t]),"cursor");break;case"hsl":[b,k,A]=z.value,f(l.toHslaString([b,k,A,t]),"cursor");break}O.value=t}function xe(t){document.addEventListener("mousemove",Y),document.addEventListener("mouseup",oe),Y(t)}function Ue(t){return t=Math.round(t*100)/100,t>1?1:t<0?0:t}function Y(t){if(!T.value)return;const{width:r,left:o}=T.value.getBoundingClientRect(),n=Ue((t.clientX-o-de)/(r-ce));Me(n)}function oe(){document.removeEventListener("mousemove",Y),document.removeEventListener("mouseup",oe),R("complete",c.value)}function F(t){if(t!==void 0){if(/^ *#/.test(t))return"hex";if(t.includes("rgb"))return"rgb";if(t.includes("hsl"))return"hsl";if(t.includes("hsv"))return"hsv"}}function Ie(){const t=u.modes.findIndex(r=>r===m.value);t!==-1?m.value=u.modes[(t+1)%u.modes.length]:m.value="rgb"}function Pe(t){const r=t.target,o=ne(r.value.toUpperCase(),m.value,"hex");f(o,"input")}function Le(t){const r=t.trim();return/^#[0-9a-fA-F]+$/.test(r)?[4,5,7,9].includes(r.length):!1}function _e(t){return/^\d{1,3}\.?\d*$/.test(t.trim())?Math.max(0,Math.min(Number.parseInt(t),360)):!1}function De(t){return/^\d{1,3}\.?\d*$/.test(t.trim())?Math.max(0,Math.min(Number.parseInt(t),100)):!1}function Fe(t){return/^\d{1,3}\.?\d*%$/.test(t.trim())?Math.max(0,Math.min(Number.parseInt(t)/100,100)):!1}function Xe(t){return/^\d{1,3}\.?\d*$/.test(t.trim())?Math.max(0,Math.min(Number.parseInt(t),255)):!1}function U(t,r){return t===void 0?"":r==="HEX"||r==="HEXA"?t:r==="A"?`${Math.floor(Number(t)*100)}%`:String(Math.floor(Number(t)))}function X(t){f(t,"input")}function I(t,r){if(m.value==="hex"){X((u.showAlpha?l.toHexaString:l.toHexString)(r));return}let o;switch(E.value===null?o=[0,0,0,0]:o=[...E.value],m.value){case"hsv":o[t]=r,X((u.showAlpha?l.toHsvaString:l.toHsvString)(o));break;case"rgb":o[t]=r,X((u.showAlpha?l.toRgbaString:l.toRgbString)(o));break;case"hsl":o[t]=r,X((u.showAlpha?l.toHslaString:l.toHslString)(o));break}}function ae(t,r){const o=t.target;let n,S,a;const s=o.value;r===void 0?a=E.value===null?void 0:E.value:a=E.value?.[r]===void 0?void 0:E.value?.[r].toString();const i=r===void 0?x.value:x.value[r];switch(i){case"HEX":case"HEXA":S=Le(s),S&&I(0,s),D.value=U(s,i);break;case"H":n=_e(s),n===!1?$.value[r]=U(a,i):I(r,n);break;case"S":case"L":case"V":n=De(s),n===!1?$.value[r]=U(a,i):I(r,n);break;case"A":n=Fe(s),n===!1?$.value[r]=U(a,i):I(r,n);break;case"R":case"G":case"B":n=Xe(s),n===!1?$.value[r]=U(a,i):I(r,n);break}}function qe(t,r){if(r==="hsv"){const[o,n,S,a]=l.hsva(t);return l.toRgbaString([...l.hsv2rgb(o,n,S),a])}return t}function Te(t){const r=document.createElement("canvas").getContext("2d");return r?(r.fillStyle=t,r.fillStyle):"#000000"}function ne(t,r,o){return o=o||F(t),o?o===r?t:{rgb:{hex(a){return l.toHexaString(l.rgba(a))},hsl(a){const[s,i,d,h]=l.rgba(a);return l.toHslaString([...l.rgb2hsl(s,i,d),h])},hsv(a){const[s,i,d,h]=l.rgba(a);return l.toHsvaString([...l.rgb2hsv(s,i,d),h])}},hex:{rgb(a){return l.toRgbaString(l.rgba(a))},hsl(a){const[s,i,d,h]=l.rgba(a);return l.toHslaString([...l.rgb2hsl(s,i,d),h])},hsv(a){const[s,i,d,h]=l.rgba(a);return l.toHsvaString([...l.rgb2hsv(s,i,d),h])}},hsl:{hex(a){const[s,i,d,h]=l.hsla(a);return l.toHexaString([...l.hsl2rgb(s,i,d),h])},rgb(a){const[s,i,d,h]=l.hsla(a);return l.toRgbaString([...l.hsl2rgb(s,i,d),h])},hsv(a){const[s,i,d,h]=l.hsla(a);return l.toHsvaString([...l.hsl2hsv(s,i,d),h])}},hsv:{hex(a){const[s,i,d,h]=l.hsva(a);return l.toHexaString([...l.hsv2rgb(s,i,d),h])},rgb(a){const[s,i,d,h]=l.hsva(a);return l.toRgbaString([...l.hsv2rgb(s,i,d),h])},hsl(a){const[s,i,d,h]=l.hsva(a);return l.toHslaString([...l.hsv2hsl(s,i,d),h])}}}[o][r](t):void 0}function Oe(t){let{value:r,mode:o}=t;return o||(o="hex",/^[a-zA-Z]+$/.test(r)?r=Te(r):(console.warn("color-picker",`color ${r} in swatches is invalid.`),r="#000000")),o===m.value?r:ne(r,m.value,o)}function Ze(t){f(Oe(t),"input")}function je(){R("confirm",c.value),q.value.hide()}function Ge(){f(void 0,"input"),R("clear"),q.value.hide()}return(t,r)=>(e.openBlock(),e.createBlock(e.unref(We.default),{ref_key:"tooltipRef",ref:q,style:e.normalizeStyle(`width: ${ee.value}; height: ${Z.value};`),"max-width":"none",arrow:!1,placement:"bottom","bg-color":"#fff","tooltip-style":{width:"240px",padding:0,borderRadius:"4px",color:"rgba(0, 0, 0, 0.88)",...t.tooltipStyle},"content-style":{width:"100%",height:"100%"},trigger:"click","transition-duration":200},{tooltip:e.withCtx(()=>[t.disabled?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("div",{class:e.normalizeClass(["color-picker-panel",{"panel-with-actions":t.actions.length}])},[e.createElementVNode("div",{ref_key:"palleteRef",ref:P,class:"color-picker-pallete",onMousedown:Re},[e.createElementVNode("div",{class:"color-picker-pallete-layer",style:e.normalizeStyle({backgroundImage:`linear-gradient(90deg, white, hsl(${V.value}, 100%, 50%))`})},null,4),r[1]||(r[1]=e.createElementVNode("div",{class:"color-picker-pallete-layer pallete-layer-shadowed",style:{"background-image":"linear-gradient(180deg, rgba(0, 0, 0, 0%), rgba(0, 0, 0, 100%))"}},null,-1)),e.createElementVNode("div",{class:"color-picker-handle",style:e.normalizeStyle(ge.value)},[e.createElementVNode("div",{class:"color-picker-handle-fill",style:e.normalizeStyle(ke.value)},null,4)],4)],544),e.createElementVNode("div",Ye,[e.createElementVNode("div",Je,[e.createElementVNode("div",{class:"color-picker-slider",style:e.normalizeStyle(K.value)},[e.createElementVNode("div",{ref_key:"hueRailRef",ref:L,style:e.normalizeStyle(ye.value),onMousedown:Ae},[e.createElementVNode("div",{style:e.normalizeStyle(`position: absolute; top: 0px; bottom: 0; left: ${p}; right: ${p}`)},[e.createElementVNode("div",{class:"color-picker-handle",style:e.normalizeStyle(Se.value)},[e.createElementVNode("div",{class:"color-picker-handle-fill",style:e.normalizeStyle(we.value)},null,4)],4)],4)],36)],4),t.showAlpha?(e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"alphaRailRef",ref:T,class:"color-picker-slider",style:e.normalizeStyle(K.value),onMousedown:xe},[e.createElementVNode("div",{style:e.normalizeStyle(`
                    border-radius: ${p};
                    position: absolute;
                    top: 0px;
                    bottom: 0;
                    left: 0px;
                    right: 0px;
                    overflow: hidden;
                  `)},[r[2]||(r[2]=e.createElementVNode("div",{class:"color-picker-checkboard"},null,-1)),e.createElementVNode("div",{class:"color-picker-slider-image",style:e.normalizeStyle(`background-image: ${Ee.value}`)},null,4)],4),v.value?(e.openBlock(),e.createElementBlock("div",{key:0,style:e.normalizeStyle(`position: absolute; top: 0px; bottom: 0; left: ${p}; right: ${p}`)},[e.createElementVNode("div",{class:"color-picker-handle",style:e.normalizeStyle(Ve.value)},[e.createElementVNode("div",{class:"color-picker-handle-fill",style:e.normalizeStyle($e.value)},null,4)],4)],4)):e.createCommentVNode("",!0)],36)):e.createCommentVNode("",!0)]),t.showPreview?(e.openBlock(),e.createElementBlock("div",Ke,[e.createElementVNode("span",{class:"color-picker-circle-fill",style:e.normalizeStyle(`background: ${Q.value||"#000000"};`)},null,4),e.createElementVNode("input",{class:"color-picker-circle-input",type:"color",value:Q.value,onChange:e.withModifiers(Pe,["stop"])},null,40,Qe)])):e.createCommentVNode("",!0)]),e.createElementVNode("div",et,[e.createElementVNode("div",{class:"color-picker-input-mode",style:e.normalizeStyle({cursor:t.modes.length===1?"":"pointer"}),onClick:Ie},e.toDisplayString(x.value),5),e.createElementVNode("div",tt,[m.value==="hex"?(e.openBlock(),e.createBlock(e.unref(se.default),e.mergeProps({key:0,size:"small",placeholder:x.value,value:D.value,"onUpdate:value":r[0]||(r[0]=o=>D.value=o),valueModifiers:{lazy:!0},onChange:ae},t.inputProps),null,16,["placeholder","value"])):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:1},e.renderList(Ne.value,(o,n)=>(e.openBlock(),e.createBlock(e.unref(se.default),e.mergeProps({size:"small",style:`${o==="A"?"flex-grow: 1.25":""}`,key:n,placeholder:o,value:$.value[n],"onUpdate:value":S=>$.value[n]=S,valueModifiers:{lazy:!0},onChange:S=>ae(S,n)},{ref_for:!0},t.inputProps),null,16,["style","placeholder","value","onUpdate:value","onChange"]))),128))])]),te.value.length?(e.openBlock(),e.createElementBlock("div",lt,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(te.value,(o,n)=>(e.openBlock(),e.createElementBlock("div",{tabindex:"0",class:"color-picker-swatch",key:n,onClick:S=>Ze(o)},[e.createElementVNode("div",{class:"color-picker-swatch-fill",style:e.normalizeStyle(`background: ${o.legalValue};`)},null,4)],8,rt))),128))])):e.createCommentVNode("",!0)],2),t.actions.length?(e.openBlock(),e.createElementBlock("div",ot,[t.actions.includes("confirm")?(e.openBlock(),e.createBlock(e.unref(ue.default),{key:0,type:"primary",size:"small",onClick:je},{default:e.withCtx(()=>[...r[3]||(r[3]=[e.createTextVNode("确认",-1)])]),_:1})):e.createCommentVNode("",!0),t.actions.includes("clear")?(e.openBlock(),e.createBlock(e.unref(ue.default),{key:1,size:"small",onClick:Ge},{default:e.withCtx(()=>[...r[4]||(r[4]=[e.createTextVNode("清除",-1)])]),_:1})):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),fe.value?(e.openBlock(),e.createElementBlock("div",at,[e.renderSlot(t.$slots,"footer",{},()=>[e.createTextVNode(e.toDisplayString(t.footer),1)],!0)])):e.createCommentVNode("",!0)],64))]),default:e.withCtx(()=>[e.createElementVNode("div",e.mergeProps({tabindex:"1",class:["color-picker-display",[`color-picker-${t.size}`,{"color-picker-disabled":t.disabled}]],style:`
        --color-picker-width: ${ee.value};
        --color-picker-height: ${Z.value};
        --color-picker-block-size: ${He.value};
        --color-picker-primary-color-hover: ${e.unref(J)[4]};
        --color-picker-primary-color-focus: ${e.unref(J)[4]};
        --color-picker-primary-shadow-color: ${e.unref(pe)};
      `},t.$attrs),[e.createElementVNode("div",nt,[e.createElementVNode("div",st,[r[5]||(r[5]=e.createElementVNode("div",{class:"color-picker-checkboard"},null,-1)),e.createElementVNode("div",{style:e.normalizeStyle(`position: absolute; left: 0; right: 0; top: 0; bottom: 0; background-color: ${z.value?e.unref(l.toHslaString)(z.value):""};`)},null,4),c.value&&z.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"color-picker-value",style:e.normalizeStyle({color:z.value[2]>50||z.value[3]<.5?"black":"white"})},[e.renderSlot(t.$slots,"label",{color:c.value},()=>[e.createTextVNode(e.toDisplayString(t.label?t.label(c.value):c.value),1)],!0)],4)):e.createCommentVNode("",!0)])])],16)]),_:3},8,["style","tooltip-style"]))}});exports.default=ut;
